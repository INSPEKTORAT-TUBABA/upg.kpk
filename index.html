<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload dan Baca PDF dengan Indikator Progres</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.4/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        #progressCircle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            border: 5px solid #ccc;
            margin: 20px;
        }

        .progress-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 20px;
        }

        #fileInput {
            display: block;
            margin: 10px auto;
        }
    </style>
</head>
<body>
    <h2>Unggah File PDF</h2>
    <input type="file" id="fileInput" accept=".pdf" />
    
    <!-- Indikator Progres -->
    <div class="progress-container">
        <canvas id="progressCircle" width="150" height="150"></canvas>
    </div>
    <br><br>

    <h3>Isi PDF</h3>
    <div id="pdfContent" style="border: 1px solid #ddd; padding: 10px; max-height: 300px; overflow-y: scroll;"></div>

    <br>
    <button onclick="downloadExcel()">Download sebagai Excel</button>
    <button onclick="downloadWord()">Download sebagai Word</button>

    <script>
        let pdfData = []; // Menyimpan isi PDF dalam format tabel
        let progressCircle = document.getElementById('progressCircle');
        let ctx = progressCircle.getContext('2d');
        let progress = 0;

        // Fungsi untuk menggambar progress melingkar
        function drawProgressCircle(percent) {
            const radius = 60;
            const circumference = 2 * Math.PI * radius;
            const offset = circumference - (percent / 100) * circumference;

            ctx.clearRect(0, 0, progressCircle.width, progressCircle.height); // Clear canvas
            ctx.lineWidth = 10;
            ctx.strokeStyle = '#4caf50'; // Color of progress
            ctx.fillStyle = '#f3f3f3'; // Background color

            ctx.beginPath();
            ctx.arc(75, 75, radius, -Math.PI / 2, 2 * Math.PI);
            ctx.stroke(); // Draw the background circle

            ctx.strokeStyle = '#2196F3'; // Progress color
            ctx.beginPath();
            ctx.arc(75, 75, radius, -Math.PI / 2, (2 * Math.PI * percent) / 100 - Math.PI / 2);
            ctx.stroke(); // Draw the progress circle

            ctx.fillStyle = '#2196F3';
            ctx.font = '20px Arial';
            ctx.fillText(Math.round(percent) + '%', 60, 85); // Display percentage in the center
        }

        // Fungsi untuk membaca dan menampilkan PDF
        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                const reader = new FileReader();
                reader.onload = function (event) {
                    const arrayBuffer = event.target.result;
                    const loadingTask = pdfjsLib.getDocument(arrayBuffer);
                    loadingTask.promise.then(pdf => {
                        const numPages = pdf.numPages;
                        let pagePromises = [];
                        for (let i = 1; i <= numPages; i++) {
                            pagePromises.push(pdf.getPage(i).then(page => {
                                return page.getTextContent().then(textContent => {
                                    const pageText = textContent.items.map(item => item.str).join(' ');
                                    pdfData.push(pageText); // Menyimpan hasil halaman dalam array
                                    displayPDFContent(pageText);
                                    progress = (i / numPages) * 100; // Update progress
                                    drawProgressCircle(progress); // Update the progress circle
                                });
                            }));
                        }

                        // Tunggu hingga semua halaman selesai diproses
                        Promise.all(pagePromises).then(() => {
                            console.log('PDF telah diproses');
                        });
                    });
                };
                reader.readAsArrayBuffer(file);
            } else {
                alert('Silakan pilih file PDF.');
            }
        });

        // Fungsi untuk menampilkan isi PDF pada halaman
        function displayPDFContent(text) {
            const div = document.getElementById('pdfContent');
            div.innerHTML += `<p>${text}</p>`;
        }

        // Fungsi untuk mengunduh sebagai file Excel
        function downloadExcel() {
            // Membuat array 2D untuk data yang akan dimasukkan ke Excel
            const data = pdfData.map(page => [page]); // Membuat setiap halaman menjadi satu baris
            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'PDF Content');
            XLSX.writeFile(wb, 'hasil_pdf.xlsx'); // Mengunduh file Excel
        }

        // Fungsi untuk mengunduh sebagai file Word
        function downloadWord() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            pdfData.forEach((pageText, index) => {
                doc.text(pageText, 10, 10 + (index * 10)); // Menambahkan teks setiap halaman ke file
            });
            doc.save('hasil_pdf.pdf'); // Mengunduh file PDF, karena jsPDF tidak mendukung .docx langsung
        }
    </script>
</body>
</html>
